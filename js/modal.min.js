/**
 * @name modal.js v1.0
 * @author Jean Ehrhardt
 * https://github.com/Houdouh/modal.js
 * A really simple, light, efficient, and usefull modal plugin
 */
!function(){var a=0,b="",c=null,d=!0,e=!1,f=null,g=/^[a-z0-9]+[\w-]*$/i,h='<header class="modal-title"><p></p></header><div class="modal-content"></div>',i=[];this.Modal=function(c){this.options={},this.dom={},a++,b="modal"+a,this.options.addCloseBtn=!0,this.options.attributes={},this.options.autoOpen=!1,this.options.closeByOverlay=!0,this.options.closeBtn="&#10006",this.options.closeBtnClass="",this.options.content="",this.options.customClass="",this.options.escapeClose=!0,this.options.headerFixed=!1,this.options.height=null,this.options.hideOverflow=!0,this.options.id=b,this.options.responsive=!0,this.options.responsiveBrink=50,this.options.template=h,this.options.title="",this.options.transition="fade",this.options.transitionDuration=400,this.options.width=null,"object"==typeof c&&j(c,this.options),i.push(this),i.length>1&&k(),null!=f&&(m(this.dom,this.options),n.call(this),this.options.autoOpen&&this.open())},Modal.prototype.open=function(a){if(!e){var b=document.getElementById(this.options.id),g=b.querySelector(".modal-wrapper");d=!1,g.style.transition="all "+this.options.transitionDuration+"ms",g.style.WebkitTransition="all "+this.options.transitionDuration+"ms",g.style.MozTransition="all "+this.options.transitionDuration+"ms",g.style.OTransition="all "+this.options.transitionDuration+"ms",g.style.msTransition="all "+this.options.transitionDuration+"ms";var h={modal:this,target:a},i=document.createEvent("CustomEvent"),j=document.createEvent("CustomEvent");if(i.initCustomEvent("beforeOpen",!1,!1,h),j.initCustomEvent("open",!1,!1,h),setTimeout(function(){b.dispatchEvent(i)},0),c.className="show",this.dom.id.className+=" open",this.options.responsive&&null!=this.options.width){var k=screen.width-this.options.responsiveBrink,l=this.options.width,m=k<=b.offsetWidth,n=k>b.offsetWidth&&b.offsetWidth<l;(m||n)&&(b.style.width=(k>l?l:k)+"px")}this.options.hideOverflow&&(f.className+=" hideOverflow"),setTimeout(function(){b.dispatchEvent(j),d=!0},this.options.transitionDuration)}},Modal.prototype.close=function(){if(d){var a=this,b=document.getElementById(this.options.id);e=!0;var g={modal:a},h=document.createEvent("CustomEvent"),i=document.createEvent("CustomEvent");h.initCustomEvent("beforeClose",!1,!1,g),i.initCustomEvent("closed",!1,!1,g),this.options.hideOverflow&&(f.className=f.className.replace(new RegExp("(^|\\b)"+"hideOverflow".split(" ").join("|")+"(\\b|$)","gi")," ")),setTimeout(function(){b.dispatchEvent(h)},0),c.className="",b.className=b.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," "),b.className+=" close",setTimeout(function(){b.className=b.className.replace(new RegExp("(^|\\b)"+"close".split(" ").join("|")+"(\\b|$)","gi")," "),b.dispatchEvent(i)},this.options.transitionDuration),setTimeout(function(){e=!1},this.options.transitionDuration>=600?this.options.transitionDuration:600)}},Modal.prototype.destroy=function(){for(var a=document.getElementById(this.options.id),b=0,c=i.length;b<c;b++)if(i[b].options.id==this.options.id){i.splice(b,1);break}setTimeout(function(){a.parentNode.removeChild(a)},this.options.transitionDuration)},Modal.prototype.setCloseByOverlay=function(a){if("boolean"!=typeof a)throw new Error("(Modal.js) The param needs to be a boolean.");this.options.closeByOverlay=a},Modal.prototype.setContent=function(a){var b=document.querySelector("#"+this.options.id+" .modal-content");if(null==b)throw new Error('(Modal.js) Your modal doesn\'t contains any "modal-content" class.');this.options.content=a,b.innerHTML=a},Modal.prototype.setSize=function(a,b){var c=document.getElementById(this.options.id);this.options.height=a,this.options.width=b,null!=a?c.style.height=a+"px":c.style.height="",null!=b?c.style.width=b+"px":c.style.width=""},Modal.prototype.setId=function(a){var b=document.getElementById(this.options.id);if("string"!=typeof a)throw new Error("(Modal.js) Your id must be a string.");this.options.id=a,b.id=a,k()},Modal.prototype.setTemplate=function(a){var b=document.getElementById(this.options.id);this.options.template=a,b.querySelector(".modal-wrapper").innerHTML=a;var c=b.querySelector(".modal-title p"),d=b.querySelector(".modal-content");null!=c&&""!=this.options.title&&(c.innerHTML=this.options.title),null!=d&&""!=this.options.content&&(d.innerHTML=this.options.content),this.options.addCloseBtn&&(l(this.options,b),this.dom.closeBtn=b.querySelector(".modal-mainClose"),n.call(this))},Modal.prototype.setTitle=function(a){var b=document.querySelector("#"+this.options.id+" .modal-title p");if(null==b)throw new Error('(Modal.js) Your modal doesn\'t contains any "modal-title" class with a <p> tag.');this.options.title=a,b.innerHTML=a},Modal.prototype.setTransition=function(a){var b=document.getElementById(this.options.id);this.options.transition=a,b.setAttribute("data-transition",a)};var j=function(a,b){var c;for(c in a)b.hasOwnProperty(c)&&(b[c]=a[c]);return b},k=function(){for(var a=[],c=null,d=0,e=i.length;d<e;d++){if(c=i[d].options.id,a.indexOf(c)>=0)throw new Error("(Modal.js) There is twice same id. There can be only unique id.");a.push(c)}},l=function(a,b){var c=b.querySelector(".modal-title"),d=document.createElement("span");if(closeBtn=null,null!=c?closeBtn=c.appendChild(d):(closeBtn=b.appendChild(d),b.insertBefore(closeBtn,b.firstChild)),closeBtn.className="modal-mainClose",""!=a.closeBtnClass)for(var e=a.closeBtnClass.split(" "),f=0,h=e.length;f<h;f++){if(!g.test(e[f]))throw new Error("(Modal.js) An invalid custom class has been specified.");closeBtn.className+=" "+e[f]}closeBtn.innerHTML=a.closeBtn},m=function(a,b){if(null==c){var d=document.createElement("div");d.id="modalBackground",f.appendChild(d),f.insertBefore(d,f.firstChild),c=document.getElementById("modalBackground")}var e=document.createElement("div"),h=document.createElement("div");if(h.className="modal-wrapper",e.appendChild(h),e.id=b.id,e.className="modal",""!=b.customClass)for(var i=b.customClass.split(" "),j=0,k=i.length;j<k;j++){if(!g.test(i[j]))throw new Error("(Modal.js) An invalid custom class has been specified.");e.className+=" "+i[j]}var m=e.querySelector(".modal-wrapper");m.innerHTML=b.template;var n=e.querySelector(".modal-title"),o=e.querySelector(".modal-content");if(n&&b.headerFixed&&(e.className+=" fixed"),b.addCloseBtn&&l(b,e),!n&&""!=b.title)throw new Error('(Modal.js) Your template doesn\'t match the model. If you want to set a title, please add a "modal-title" class with a <p> inside.');if(!o&&""!=b.content)throw new Error('(Modal.js) Your template doesn\'t match the model. If you want to set a content, please add a "modal-content" class to your container.');""!=b.title&&(n.querySelector("p").innerHTML=b.title),""!=b.content&&(o.innerHTML=b.content),null!=b.height&&(e.style.height=b.height+"px"),null!=b.width&&(e.style.width=b.width+"px",b.width<250&&(e.style.minWidth=b.width+"px")),e.setAttribute("data-transition",b.transition);var p;for(p in b.attributes)e.setAttribute("data-"+p,b.attributes[p]);c.appendChild(e),a.id=document.getElementById(e.id),b.addCloseBtn&&(a.closeBtn=closeBtn)},n=function(){this.options.addCloseBtn&&this.dom.closeBtn.addEventListener("click",this.close.bind(this))},o=function(a){modals=document.querySelectorAll("#modalBackground .modal");for(var b=0,c=modals.length;b<c;b++)if(new RegExp("(^| )open( |$)","gi").test(modals[b].className)){var d=p(modals[b].id);if(d.options.responsive&&null!=d.options.width){var e=screen.width-d.options.responsiveBrink,f=e<=modals[b].offsetWidth,g=e>modals[b].offsetWidth&&modals[b].offsetWidth<d.options.width;(f||g)&&(modals[b].style.width=e+"px")}break}},p=function(a){for(var b=null,c=0,d=i.length;c<d;c++)if(i[c].options.id===a){b=i[c];break}if(null==b)throw new Error("(Modal.js) The according modal instance no longer exists.");return b},q=function(){f=document.body;var a,b,d=null,e=function(c){if(a=c.target,b=a.getAttribute("data-modal")){var d=p(b);d.open(a)}},g=function(b){if(a=b.target,"modalBackground"===a.id){d=document.querySelectorAll("#modalBackground .modal");for(var c=0,e=d.length;c<e;c++)if(new RegExp("(^| )open( |$)","gi").test(d[c].className)){var f=p(d[c].id);f.options.closeByOverlay&&f.close();break}}},h=function(b){if(a=b.target,"modal-close"===a.className){d=document.querySelectorAll("#modalBackground .modal");for(var c=0,e=d.length;c<e;c++)if(new RegExp("(^| )open( |$)","gi").test(d[c].className)){var f=p(d[c].id);f.close();break}}},j=function(){d=document.querySelectorAll("#modalBackground .modal");for(var a=0,b=d.length;a<b;a++)if(new RegExp("(^| )open( |$)","gi").test(d[a].className)){var c=p(d[a].id);c.options.escapeClose&&c.close();break}};f.addEventListener("click",function(a){e(a),h(a),c&&new RegExp("(^| )show( |$)","gi").test(c.className)&&g(a)}),document.addEventListener("keydown",function(a){c&&new RegExp("(^| )show( |$)","gi").test(c.className)&&27==a.keyCode&&j()}),window.addEventListener("resize",function(){c&&new RegExp("(^| )show( |$)","gi").test(c.className)&&o()});for(var k=null,l=0,q=i.length;l<q;l++)k=i[l],m(k.dom,k.options),n.call(k),k.options.autoOpen&&k.open()};document.onreadystatechange=function(){"interactive"==document.readyState&&q()}}();