/**
 * @name modal.js v1.0
 * @author Jean Ehrhardt
 * A really simple, light, efficient, and usefull modal plugin
 */
!function(){var a=0,b="",c=null,d=!1,e='<header class="modal-title"><p></p></header><div class="modal-content"></div>',f=[];this.Modal=function(c){this.options={},this.dom={},a++,b="modal"+a,this.options.addCloseBtn=!0,this.options.attributes={},this.options.autoOpen=!1,this.options.closeByOverlay=!0,this.options.closeBtn="&#10006",this.options.closeBtnClass="",this.options.content="",this.options.customClass="",this.options.escapeClose=!0,this.options.height=400,this.options.id=b,this.options.template=e,this.options.title="",this.options.transition="fade",this.options.transitionDuration=400,this.options.width=500,"object"==typeof c&&g(c,this.options),f.push(this),f.length>1&&h()},Modal.prototype.open=function(){if(!d){var a=document.getElementById(this.options.id);c.style.transitionDuration=this.options.transitionDuration+"ms";var b=document.createEvent("CustomEvent"),e=document.createEvent("CustomEvent");b.initCustomEvent("beforeOpen",!1,!1,this),e.initCustomEvent("opened",!1,!1,this),setTimeout(function(){a.dispatchEvent(b)},0),c.className="show",this.dom.id.style.display="block",setTimeout(function(){a.dispatchEvent(e)},this.options.transitionDuration)}},Modal.prototype.close=function(){var a=this,b=document.getElementById(this.options.id);d=!0;var e=document.createEvent("CustomEvent"),f=document.createEvent("CustomEvent");e.initCustomEvent("beforeClose",!1,!1,a),f.initCustomEvent("closed",!1,!1,a),setTimeout(function(){b.dispatchEvent(e)},0),c.className="",b.className+=" close",setTimeout(function(){b.className=b.className.replace(new RegExp("(^|\\b)"+"close".split(" ").join("|")+"(\\b|$)","gi")," "),b.style.display="none",b.dispatchEvent(f)},this.options.transitionDuration),setTimeout(function(){d=!1},this.options.transitionDuration>=600?this.options.transitionDuration:600)},Modal.prototype.destroy=function(){for(var a=document.getElementById(this.options.id),b=0,c=f.length;b<c;b++)if(f[b].options.id==this.options.id){f.splice(b,1);break}setTimeout(function(){a.parentNode.removeChild(a)},this.options.transitionDuration)},Modal.prototype.setCloseByOverlay=function(a){if("boolean"!=typeof a)throw new Error("(Modal.js) The param needs to be a boolean.");this.options.closeByOverlay=a},Modal.prototype.setContent=function(a){var b=document.querySelector("#"+this.options.id+" .modal-content");if(null==b)throw new Error('(Modal.js) Your modal doesn\'t contains any "modal-content" class.');this.options.content=a,b.innerHTML=a},Modal.prototype.setSize=function(a,b){var c=document.getElementById(this.options.id);if("number"!=typeof a||"number"!=typeof b)throw new Error("(Modal.js) Your sizes are incorrect.");this.options.height=a,this.options.width=b,c.style.height=a+"px",c.style.width=b+"px"},Modal.prototype.setId=function(a){var b=document.getElementById(this.options.id);if("string"!=typeof a)throw new Error("(Modal.js) Your id must be a string.");this.options.id=a,b.id=a,console.log(this.dom),h()},Modal.prototype.setTemplate=function(a){var b=document.getElementById(this.options.id);this.options.template=a,b.innerHTML=a;var c=b.querySelector(".modal-title p"),d=b.querySelector(".modal-content");null!=c&&""!=this.options.title&&(c.innerHTML=this.options.title),null!=d&&""!=this.options.content&&(d.innerHTML=this.options.content),this.options.addCloseBtn&&(createCloseButton(this.options,b),this.dom.closeBtn=b.querySelector(".modal-mainClose"),initialiseModalEvents.call(this))},Modal.prototype.setTitle=function(a){var b=document.querySelector("#"+this.options.id+" .modal-title p");if(null==b)throw new Error('(Modal.js) Your modal doesn\'t contains any "modal-title" class with a <p> tag.');this.options.title=a,b.innerHTML=a},Modal.prototype.setTransition=function(a){var b=document.getElementById(this.options.id);this.options.transition=a,b.setAttribute("data-transition",a)};var g=function(a,b){var c;for(c in a)b.hasOwnProperty(c)&&(b[c]=a[c]);return b},h=function(){for(var a=[],c=null,d=0,e=f.length;d<e;d++){if(c=f[d].options.id,a.indexOf(c)>=0)throw new Error("(Modal.js) There is twice same id. There can be only unique id.");a.push(c)}},i=function(){var i,j,a=document.body,b=/^[a-z0-9]+[\w-]*$/i,d=function(a,c){var d=c.querySelector(".modal-title"),e=document.createElement("span");if(closeBtn=null,null!=d?closeBtn=d.appendChild(e):(closeBtn=c.appendChild(e),c.insertBefore(closeBtn,c.firstChild)),closeBtn.className="modal-mainClose",""!=a.closeBtnClass)for(var f=a.closeBtnClass.split(" "),g=0,h=f.length;g<h;g++){if(!b.test(f[g]))throw new Error("(Modal.js) An invalid custom class has been specified.");closeBtn.className+=" "+f[g]}closeBtn.innerHTML=a.closeBtn},e=function(e,f){if(null==c){var g=document.createElement("div");g.id="modalBackground",a.appendChild(g),a.insertBefore(g,a.firstChild),c=document.getElementById("modalBackground")}var h=document.createElement("div");if(h.id=f.id,h.className="modal",""!=f.customClass)for(var i=f.customClass.split(" "),j=0,k=i.length;j<k;j++){if(!b.test(i[j]))throw new Error("(Modal.js) An invalid custom class has been specified.");h.className+=" "+i[j]}h.innerHTML=f.template;var l=h.querySelector(".modal-title"),m=h.querySelector(".modal-content");if(f.addCloseBtn&&d(f,h),null==l&&""!=f.title)throw new Error('(Modal.js) Your template doesn\'t match the model. If you want to set a title, please add a "modal-title" class with a <p> inside.');if(null==m&&""!=f.content)throw new Error('(Modal.js) Your template doesn\'t match the model. If you want to set a content, please add a "modal-content" class to your container.');if(""!=f.title&&(l.querySelector("p").innerHTML=f.title),""!=f.content&&(m.innerHTML=f.content),h.style.height=f.height+"px",h.style.width=f.width+"px",h.style.animationDuration=f.transitionDuration+"ms","donna"==f.transition)for(var n=h.childNodes,j=0,k=n.length;j<k;j++)n[j].style.animationDuration=f.transitionDuration+"ms";h.setAttribute("data-transition",f.transition);var o;for(o in f.attributes)h.setAttribute("data-"+o,f.attributes[o]);c.appendChild(h),e.id=document.getElementById(h.id),f.addCloseBtn&&(e.closeBtn=closeBtn)},g=function(){this.options.addCloseBtn&&this.dom.closeBtn.addEventListener("click",this.close.bind(this))},h=function(a){for(var b=null,c=0,d=f.length;c<d;c++)if(f[c].options.id===a){b=f[c];break}if(null==b)throw new Error("(Modal.js) The according modal instance no longer exists.");return b},k=null,l=function(a){if(i=a.target,j=i.getAttribute("data-modal")){var b=h(j);b.open()}},m=function(a){if(i=a.target,"modalBackground"===i.id){k=document.querySelectorAll("#modalBackground .modal");for(var b=0,c=k.length;b<c;b++)if("block"==k[b].style.display){var d=h(k[b].id);d.options.closeByOverlay&&d.close();break}}},n=function(a){if(i=a.target,"modal-close"===i.className){k=document.querySelectorAll("#modalBackground .modal");for(var b=0,c=k.length;b<c;b++)if("block"==k[b].style.display){var d=h(k[b].id);d.close();break}}},o=function(){k=document.querySelectorAll("#modalBackground .modal");for(var a=0,b=k.length;a<b;a++)if("block"==k[a].style.display){var c=h(k[a].id);c.options.escapeClose&&c.close();break}};a.addEventListener("click",function(a){l(a),m(a),n(a)}),document.addEventListener("keydown",function(a){new RegExp("(^| )show( |$)","gi").test(c.className)&&27==a.keyCode&&o()});for(var p=null,q=0,r=f.length;q<r;q++)p=f[q],e(p.dom,p.options),g.call(p),p.options.autoOpen&&p.open()};document.onreadystatechange=function(){"interactive"==document.readyState&&i()}}();