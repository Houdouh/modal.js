/**
 * @name modal.js v1.0
 * @author Jean Ehrhardt
 * A really simple, light, efficient, and usefull modal plugin
 */
!function(){var a=0,b="",c=null,d=!1,e=null,f=/^[a-z0-9]+[\w-]*$/i,g='<header class="modal-title"><p></p></header><div class="modal-content"></div>',h=[];this.Modal=function(c){this.options={},this.dom={},a++,b="modal"+a,this.options.addCloseBtn=!0,this.options.attributes={},this.options.autoOpen=!1,this.options.closeByOverlay=!0,this.options.closeBtn="&#10006",this.options.closeBtnClass="",this.options.content="",this.options.customClass="",this.options.escapeClose=!0,this.options.height=400,this.options.id=b,this.options.template=g,this.options.title="",this.options.transition="fade",this.options.transitionDuration=400,this.options.width=500,"object"==typeof c&&i(c,this.options),h.push(this),h.length>1&&j(),null!=e&&(l(this.dom,this.options),m.call(this))},Modal.prototype.open=function(){if(!d){var a=document.getElementById(this.options.id);c.style.transitionDuration=this.options.transitionDuration+"ms";var b=document.createEvent("CustomEvent"),e=document.createEvent("CustomEvent");b.initCustomEvent("beforeOpen",!1,!1,this),e.initCustomEvent("opened",!1,!1,this),setTimeout(function(){a.dispatchEvent(b)},0),c.className="show",this.dom.id.style.display="block",setTimeout(function(){a.dispatchEvent(e)},this.options.transitionDuration)}},Modal.prototype.close=function(){var a=this,b=document.getElementById(this.options.id);d=!0;var e=document.createEvent("CustomEvent"),f=document.createEvent("CustomEvent");e.initCustomEvent("beforeClose",!1,!1,a),f.initCustomEvent("closed",!1,!1,a),setTimeout(function(){b.dispatchEvent(e)},0),c.className="",b.className+=" close",setTimeout(function(){b.className=b.className.replace(new RegExp("(^|\\b)"+"close".split(" ").join("|")+"(\\b|$)","gi")," "),b.style.display="none",b.dispatchEvent(f)},this.options.transitionDuration),setTimeout(function(){d=!1},this.options.transitionDuration>=600?this.options.transitionDuration:600)},Modal.prototype.destroy=function(){for(var a=document.getElementById(this.options.id),b=0,c=h.length;b<c;b++)if(h[b].options.id==this.options.id){h.splice(b,1);break}setTimeout(function(){a.parentNode.removeChild(a)},this.options.transitionDuration)},Modal.prototype.setCloseByOverlay=function(a){if("boolean"!=typeof a)throw new Error("(Modal.js) The param needs to be a boolean.");this.options.closeByOverlay=a},Modal.prototype.setContent=function(a){var b=document.querySelector("#"+this.options.id+" .modal-content");if(null==b)throw new Error('(Modal.js) Your modal doesn\'t contains any "modal-content" class.');this.options.content=a,b.innerHTML=a},Modal.prototype.setSize=function(a,b){var c=document.getElementById(this.options.id);if("number"!=typeof a||"number"!=typeof b)throw new Error("(Modal.js) Your sizes are incorrect.");this.options.height=a,this.options.width=b,c.style.height=a+"px",c.style.width=b+"px"},Modal.prototype.setId=function(a){var b=document.getElementById(this.options.id);if("string"!=typeof a)throw new Error("(Modal.js) Your id must be a string.");this.options.id=a,b.id=a,console.log(this.dom),j()},Modal.prototype.setTemplate=function(a){var b=document.getElementById(this.options.id);this.options.template=a,b.innerHTML=a;var c=b.querySelector(".modal-title p"),d=b.querySelector(".modal-content");null!=c&&""!=this.options.title&&(c.innerHTML=this.options.title),null!=d&&""!=this.options.content&&(d.innerHTML=this.options.content),this.options.addCloseBtn&&(k(this.options,b),this.dom.closeBtn=b.querySelector(".modal-mainClose"),m.call(this))},Modal.prototype.setTitle=function(a){var b=document.querySelector("#"+this.options.id+" .modal-title p");if(null==b)throw new Error('(Modal.js) Your modal doesn\'t contains any "modal-title" class with a <p> tag.');this.options.title=a,b.innerHTML=a},Modal.prototype.setTransition=function(a){var b=document.getElementById(this.options.id);this.options.transition=a,b.setAttribute("data-transition",a)};var i=function(a,b){var c;for(c in a)b.hasOwnProperty(c)&&(b[c]=a[c]);return b},j=function(){for(var a=[],c=null,d=0,e=h.length;d<e;d++){if(c=h[d].options.id,a.indexOf(c)>=0)throw new Error("(Modal.js) There is twice same id. There can be only unique id.");a.push(c)}},k=function(a,b){var c=b.querySelector(".modal-title"),d=document.createElement("span");if(closeBtn=null,null!=c?closeBtn=c.appendChild(d):(closeBtn=b.appendChild(d),b.insertBefore(closeBtn,b.firstChild)),closeBtn.className="modal-mainClose",""!=a.closeBtnClass)for(var e=a.closeBtnClass.split(" "),g=0,h=e.length;g<h;g++){if(!f.test(e[g]))throw new Error("(Modal.js) An invalid custom class has been specified.");closeBtn.className+=" "+e[g]}closeBtn.innerHTML=a.closeBtn},l=function(a,b){if(null==c){var d=document.createElement("div");d.id="modalBackground",e.appendChild(d),e.insertBefore(d,e.firstChild),c=document.getElementById("modalBackground")}var g=document.createElement("div");if(g.id=b.id,g.className="modal",""!=b.customClass)for(var h=b.customClass.split(" "),i=0,j=h.length;i<j;i++){if(!f.test(h[i]))throw new Error("(Modal.js) An invalid custom class has been specified.");g.className+=" "+h[i]}g.innerHTML=b.template;var l=g.querySelector(".modal-title"),m=g.querySelector(".modal-content");if(b.addCloseBtn&&k(b,g),null==l&&""!=b.title)throw new Error('(Modal.js) Your template doesn\'t match the model. If you want to set a title, please add a "modal-title" class with a <p> inside.');if(null==m&&""!=b.content)throw new Error('(Modal.js) Your template doesn\'t match the model. If you want to set a content, please add a "modal-content" class to your container.');if(""!=b.title&&(l.querySelector("p").innerHTML=b.title),""!=b.content&&(m.innerHTML=b.content),g.style.height=b.height+"px",g.style.width=b.width+"px",g.style.animationDuration=b.transitionDuration+"ms","donna"==b.transition)for(var n=g.childNodes,i=0,j=n.length;i<j;i++)n[i].style.animationDuration=b.transitionDuration+"ms";g.setAttribute("data-transition",b.transition);var o;for(o in b.attributes)g.setAttribute("data-"+o,b.attributes[o]);c.appendChild(g),a.id=document.getElementById(g.id),b.addCloseBtn&&(a.closeBtn=closeBtn)},m=function(){this.options.addCloseBtn&&this.dom.closeBtn.addEventListener("click",this.close.bind(this))},n=function(a){for(var b=null,c=0,d=h.length;c<d;c++)if(h[c].options.id===a){b=h[c];break}if(null==b)throw new Error("(Modal.js) The according modal instance no longer exists.");return b},o=function(){e=document.body;var a,b,d=null,f=function(c){if(a=c.target,b=a.getAttribute("data-modal")){var d=n(b);d.open()}},g=function(b){if(a=b.target,"modalBackground"===a.id){d=document.querySelectorAll("#modalBackground .modal");for(var c=0,e=d.length;c<e;c++)if("block"==d[c].style.display){var f=n(d[c].id);f.options.closeByOverlay&&f.close();break}}},i=function(b){if(a=b.target,"modal-close"===a.className){d=document.querySelectorAll("#modalBackground .modal");for(var c=0,e=d.length;c<e;c++)if("block"==d[c].style.display){var f=n(d[c].id);f.close();break}}},j=function(){d=document.querySelectorAll("#modalBackground .modal");for(var a=0,b=d.length;a<b;a++)if("block"==d[a].style.display){var c=n(d[a].id);c.options.escapeClose&&c.close();break}};e.addEventListener("click",function(a){f(a),g(a),i(a)}),document.addEventListener("keydown",function(a){new RegExp("(^| )show( |$)","gi").test(c.className)&&27==a.keyCode&&j()});for(var k=null,o=0,p=h.length;o<p;o++)k=h[o],l(k.dom,k.options),m.call(k),k.options.autoOpen&&k.open()};document.onreadystatechange=function(){"interactive"==document.readyState&&o()}}();