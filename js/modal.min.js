/**
 * @name Modal.js v1.0
 * @author Jean Ehrhardt
 * This library will open a customisable modal with HTML contents.
 */
!function(){var a=document.body,b=/^[a-z0-9]+[\w-]*$/i,c=null,d=0,f="",g=!1,h='<header class="modal-title"><p></p></header><div class="modal-content"></div>',i=[];this.Modal=function(a){this.options={},this.dom={},d++,f="modal"+d,this.options.addCloseBtn=!0,this.options.attributes={},this.options.autoOpen=!1,this.options.closeByOverlay=!0,this.options.closeBtn="&#10006",this.options.closeBtnClass="",this.options.content="",this.options.customClass="",this.options.escapeClose=!0,this.options.height=400,this.options.id=f,this.options.template=h,this.options.title="",this.options.transition="fade",this.options.transitionDuration=400,this.options.width=500,"object"==typeof a&&j(a,this.options),i.push(this),i.length>1&&k(),m(this.dom,this.options),n.call(this),this.options.autoOpen&&this.open()},Modal.prototype.open=function(){if(!g){var a=document.getElementById(this.options.id);c.style.transitionDuration=this.options.transitionDuration+"ms";var b=document.createEvent("CustomEvent"),d=document.createEvent("CustomEvent");b.initCustomEvent("beforeOpen",!1,!1,this),d.initCustomEvent("opened",!1,!1,this),setTimeout(function(){a.dispatchEvent(b)},0),c.className="show",this.dom.id.style.display="block",setTimeout(function(){a.dispatchEvent(d)},this.options.transitionDuration)}},Modal.prototype.close=function(){var a=this,b=document.getElementById(this.options.id);g=!0;var d=document.createEvent("CustomEvent"),e=document.createEvent("CustomEvent");d.initCustomEvent("beforeClose",!1,!1,a),e.initCustomEvent("closed",!1,!1,a),setTimeout(function(){b.dispatchEvent(d)},0),c.className="",b.className+=" close",setTimeout(function(){b.className=b.className.replace(new RegExp("(^|\\b)"+"close".split(" ").join("|")+"(\\b|$)","gi")," "),b.style.display="none",b.dispatchEvent(e)},this.options.transitionDuration),setTimeout(function(){g=!1},this.options.transitionDuration>=600?this.options.transitionDuration:600)},Modal.prototype.destroy=function(){for(var a=document.getElementById(this.options.id),b=0,c=i.length;b<c;b++)if(i[b].options.id==this.options.id){i.splice(b,1);break}setTimeout(function(){a.parentNode.removeChild(a)},this.options.transitionDuration)},Modal.prototype.setCloseByOverlay=function(a){if("boolean"!=typeof a)throw new Error("(Modal.js) The param needs to be a boolean.");this.options.closeByOverlay=a},Modal.prototype.setContent=function(a){var b=document.querySelector("#"+this.options.id+" .modal-content");if(null==b)throw new Error('(Modal.js) Your modal doesn\'t contains any "modal-content" class.');this.options.content=a,b.innerHTML=a},Modal.prototype.setSize=function(a,b){var c=document.getElementById(this.options.id);if("number"!=typeof a||"number"!=typeof b)throw new Error("(Modal.js) Your sizes are incorrect.");this.options.height=a,this.options.width=b,c.style.height=a+"px",c.style.width=b+"px"},Modal.prototype.setId=function(a){var b=document.getElementById(this.options.id);if("string"!=typeof a)throw new Error("(Modal.js) Your id must be a string.");this.options.id=a,b.id=a,console.log(this.dom),k()},Modal.prototype.setTemplate=function(a){var b=document.getElementById(this.options.id);this.options.template=a,b.innerHTML=a;var c=b.querySelector(".modal-title p"),d=b.querySelector(".modal-content");null!=c&&""!=this.options.title&&(c.innerHTML=this.options.title),null!=d&&""!=this.options.content&&(d.innerHTML=this.options.content),this.options.addCloseBtn&&(l(this.options,b),this.dom.closeBtn=b.querySelector(".modal-mainClose"),n.call(this))},Modal.prototype.setTitle=function(a){var b=document.querySelector("#"+this.options.id+" .modal-title p");if(null==b)throw new Error('(Modal.js) Your modal doesn\'t contains any "modal-title" class with a <p> tag.');this.options.title=a,b.innerHTML=a},Modal.prototype.setTransition=function(a){var b=document.getElementById(this.options.id);this.options.transition=a,b.setAttribute("data-transition",a)};var p,q,j=function(a,b){var c;for(c in a)b.hasOwnProperty(c)&&(b[c]=a[c]);return b},k=function(){for(var a=[],c=null,d=0,e=i.length;d<e;d++){if(c=i[d].options.id,a.indexOf(c)>=0)throw new Error("(Modal.js) There is twice same id. There can be only unique id.");a.push(c)}},l=function(a,c){var d=c.querySelector(".modal-title"),e=document.createElement("span");if(closeBtn=null,null!=d?closeBtn=d.appendChild(e):(closeBtn=c.appendChild(e),c.insertBefore(closeBtn,c.firstChild)),closeBtn.className="modal-mainClose",""!=a.closeBtnClass)for(var f=a.closeBtnClass.split(" "),g=0,h=f.length;g<h;g++){if(!b.test(f[g]))throw new Error("(Modal.js) An invalid custom class has been specified.");closeBtn.className+=" "+f[g]}closeBtn.innerHTML=a.closeBtn},m=function(d,e){if(null==c){var f=document.createElement("div");f.id="modalBackground",a.appendChild(f),a.insertBefore(f,a.firstChild),c=document.getElementById("modalBackground")}var g=document.createElement("div");if(g.id=e.id,g.className="modal",""!=e.customClass)for(var h=e.customClass.split(" "),i=0,j=h.length;i<j;i++){if(!b.test(h[i]))throw new Error("(Modal.js) An invalid custom class has been specified.");g.className+=" "+h[i]}g.innerHTML=e.template;var k=g.querySelector(".modal-title"),m=g.querySelector(".modal-content");if(e.addCloseBtn&&l(e,g),null==k&&""!=e.title)throw new Error('(Modal.js) Your template doesn\'t match the model. If you want to set a title, please add a "modal-title" class with a <p> inside.');if(null==m&&""!=e.content)throw new Error('(Modal.js) Your template doesn\'t match the model. If you want to set a content, please add a "modal-content" class to your container.');if(""!=e.title&&(k.querySelector("p").innerHTML=e.title),""!=e.content&&(m.innerHTML=e.content),g.style.height=e.height+"px",g.style.width=e.width+"px",g.style.animationDuration=e.transitionDuration+"ms","donna"==e.transition)for(var n=g.childNodes,i=0,j=n.length;i<j;i++)n[i].style.animationDuration=e.transitionDuration+"ms";g.setAttribute("data-transition",e.transition);var o;for(o in e.attributes)g.setAttribute("data-"+o,e.attributes[o]);c.appendChild(g),d.id=document.getElementById(g.id),e.addCloseBtn&&(d.closeBtn=closeBtn)},n=function(){this.options.addCloseBtn&&this.dom.closeBtn.addEventListener("click",this.close.bind(this))},o=function(a){for(var b=null,c=0,d=i.length;c<d;c++)if(i[c].options.id===a){b=i[c];break}if(null==b)throw new Error("(Modal.js) The according modal instance no longer exists.");return b},r=null,s=function(a){if(p=a.target,q=p.getAttribute("data-modal")){var b=o(q);b.open()}},t=function(a){if(p=a.target,"modalBackground"===p.id){r=document.querySelectorAll("#modalBackground .modal");for(var b=0,c=r.length;b<c;b++)if("block"==r[b].style.display){var d=o(r[b].id);d.options.closeByOverlay&&d.close();break}}},u=function(a){if(p=a.target,"modal-close"===p.className){r=document.querySelectorAll("#modalBackground .modal");for(var b=0,c=r.length;b<c;b++)if("block"==r[b].style.display){var d=o(r[b].id);d.close();break}}},v=function(){r=document.querySelectorAll("#modalBackground .modal");for(var a=0,b=r.length;a<b;a++)if("block"==r[a].style.display){var c=o(r[a].id);c.options.escapeClose&&c.close();break}};a.addEventListener("click",function(a){s(a),t(a),u(a)}),document.addEventListener("keydown",function(a){new RegExp("(^| )show( |$)","gi").test(c.className)&&27==a.keyCode&&v()})}();