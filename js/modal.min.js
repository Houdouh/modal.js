/**
 * @name modal.js v1.0
 * @author Jean Ehrhardt
 * https://github.com/Houdouh/modal.js
 * A really simple, light, efficient, and usefull modal plugin
 */
!function(){var t=0,o="",e=null,n=!0,i=!1,s=null,a=/^[a-z0-9]+[\w-]*$/i,l=[];this.Modal=function(e){this.options={},this.dom={},o="modal"+ ++t,this.options.addCloseBtn=!0,this.options.attributes={},this.options.autoOpen=!1,this.options.closeByOverlay=!0,this.options.closeBtn="&#10006",this.options.closeBtnClass="",this.options.content="",this.options.customClass="",this.options.escapeClose=!0,this.options.headerFixed=!1,this.options.height=null,this.options.hideOverflow=!0,this.options.id=o,this.options.responsive=!0,this.options.responsiveBrink=50,this.options.template='<header class="modal-title"><p></p></header><div class="modal-content"></div>',this.options.title="",this.options.transition="fade",this.options.transitionDuration=400,this.options.width=null,"object"==typeof e&&r(e,this.options),l.push(this),l.length>1&&d(),null!=s&&(p(this.dom,this.options),h.call(this),this.options.autoOpen&&this.open())},Modal.prototype.open=function(t){if(!i){var o=document.getElementById(this.options.id),a=o.querySelector(".modal-wrapper");n=!1,a.style.transition="all "+this.options.transitionDuration+"ms",a.style.WebkitTransition="all "+this.options.transitionDuration+"ms",a.style.MozTransition="all "+this.options.transitionDuration+"ms",a.style.OTransition="all "+this.options.transitionDuration+"ms",a.style.msTransition="all "+this.options.transitionDuration+"ms";var l={modal:this,target:t},r=document.createEvent("CustomEvent"),d=document.createEvent("CustomEvent");if(r.initCustomEvent("beforeOpen",!1,!1,l),d.initCustomEvent("open",!1,!1,l),setTimeout(function(){o.dispatchEvent(r)},0),e.className="show",this.dom.id.className+=" open",this.options.responsive&&null!=this.options.width){var c=screen.width-this.options.responsiveBrink,p=this.options.width,h=c<=o.offsetWidth,u=c>o.offsetWidth&&o.offsetWidth<p;(h||u)&&(o.style.width=(c>p?p:c)+"px")}this.options.hideOverflow&&(s.className+=" hideOverflow"),setTimeout(function(){o.dispatchEvent(d),n=!0},this.options.transitionDuration)}},Modal.prototype.close=function(){if(n){var t=this,o=document.getElementById(this.options.id);i=!0;var a={modal:t},l=document.createEvent("CustomEvent"),r=document.createEvent("CustomEvent");l.initCustomEvent("beforeClose",!1,!1,a),r.initCustomEvent("closed",!1,!1,a),this.options.hideOverflow&&(s.className=s.className.replace(new RegExp("(^|\\b)"+"hideOverflow".split(" ").join("|")+"(\\b|$)","gi")," ")),setTimeout(function(){o.dispatchEvent(l)},0),e.className="",o.className=o.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," "),o.className+=" close",setTimeout(function(){o.className=o.className.replace(new RegExp("(^|\\b)"+"close".split(" ").join("|")+"(\\b|$)","gi")," "),o.dispatchEvent(r)},this.options.transitionDuration),setTimeout(function(){i=!1},this.options.transitionDuration>=600?this.options.transitionDuration:600)}},Modal.prototype.destroy=function(){for(var t=document.getElementById(this.options.id),o=0,e=l.length;o<e;o++)if(l[o].options.id==this.options.id){l.splice(o,1);break}setTimeout(function(){t.parentNode.removeChild(t)},this.options.transitionDuration)},Modal.prototype.setCloseByOverlay=function(t){if("boolean"!=typeof t)throw new Error("(Modal.js) The param needs to be a boolean.");this.options.closeByOverlay=t},Modal.prototype.setContent=function(t){var o=document.querySelector("#"+this.options.id+" .modal-content");if(null==o)throw new Error('(Modal.js) Your modal doesn\'t contains any "modal-content" class.');this.options.content=t,o.innerHTML=t},Modal.prototype.setSize=function(t,o){var e=document.getElementById(this.options.id);this.options.height=t,this.options.width=o,e.style.height=null!=t?t+"px":"",e.style.width=null!=o?o+"px":""},Modal.prototype.setId=function(t){var o=document.getElementById(this.options.id);if("string"!=typeof t)throw new Error("(Modal.js) Your id must be a string.");this.options.id=t,o.id=t,d()},Modal.prototype.setTemplate=function(t){var o=document.getElementById(this.options.id);this.options.template=t,o.querySelector(".modal-wrapper").innerHTML=t;var e=o.querySelector(".modal-title p"),n=o.querySelector(".modal-content");null!=e&&""!=this.options.title&&(e.innerHTML=this.options.title),null!=n&&""!=this.options.content&&(n.innerHTML=this.options.content),this.options.addCloseBtn&&(c(this.options,o),this.dom.closeBtn=o.querySelector(".modal-mainClose"),h.call(this))},Modal.prototype.setTitle=function(t){var o=document.querySelector("#"+this.options.id+" .modal-title p");if(null==o)throw new Error('(Modal.js) Your modal doesn\'t contains any "modal-title" class with a <p> tag.');this.options.title=t,o.innerHTML=t},Modal.prototype.setTransition=function(t){var o=document.getElementById(this.options.id);this.options.transition=t,o.setAttribute("data-transition",t)};var r=function(t,o){var e;for(e in t)o.hasOwnProperty(e)&&(o[e]=t[e]);return o},d=function(){for(var t=[],o=null,e=0,n=l.length;e<n;e++){if(o=l[e].options.id,t.indexOf(o)>=0)throw new Error("(Modal.js) There is twice same id. There can be only unique id.");t.push(o)}},c=function(t,o){var e=o.querySelector(".modal-title"),n=document.createElement("span");if(closeBtn=null,null!=e?closeBtn=e.appendChild(n):(closeBtn=o.appendChild(n),o.insertBefore(closeBtn,o.firstChild)),closeBtn.className="modal-mainClose",""!=t.closeBtnClass)for(var i=t.closeBtnClass.split(" "),s=0,l=i.length;s<l;s++){if(!a.test(i[s]))throw new Error("(Modal.js) An invalid custom class has been specified.");closeBtn.className+=" "+i[s]}closeBtn.innerHTML=t.closeBtn},p=function(t,o){if(null==e){var n=document.createElement("div");n.id="modalBackground",s.appendChild(n),s.insertBefore(n,s.firstChild),e=document.getElementById("modalBackground")}var i=document.createElement("div"),l=document.createElement("div");if(l.className="modal-wrapper",i.appendChild(l),i.id=o.id,i.className="modal",""!=o.customClass)for(var r=o.customClass.split(" "),d=0,p=r.length;d<p;d++){if(!a.test(r[d]))throw new Error("(Modal.js) An invalid custom class has been specified.");i.className+=" "+r[d]}i.querySelector(".modal-wrapper").innerHTML=o.template;var h=i.querySelector(".modal-title"),u=i.querySelector(".modal-content");if(h&&o.headerFixed&&(i.className+=" fixed"),o.addCloseBtn&&c(o,i),!h&&""!=o.title)throw new Error('(Modal.js) Your template doesn\'t match the model. If you want to set a title, please add a "modal-title" class with a <p> inside.');if(!u&&""!=o.content)throw new Error('(Modal.js) Your template doesn\'t match the model. If you want to set a content, please add a "modal-content" class to your container.');""!=o.title&&(h.querySelector("p").innerHTML=o.title),""!=o.content&&(u.innerHTML=o.content),null!=o.height&&(i.style.height=o.height+"px"),null!=o.width&&(i.style.width=o.width+"px",o.width<250&&(i.style.minWidth=o.width+"px")),i.setAttribute("data-transition",o.transition);var m;for(m in o.attributes)i.setAttribute("data-"+m,o.attributes[m]);e.appendChild(i),t.id=document.getElementById(i.id),o.addCloseBtn&&(t.closeBtn=closeBtn)},h=function(){this.options.addCloseBtn&&this.dom.closeBtn.addEventListener("click",this.close.bind(this))},u=function(t){modals=document.querySelectorAll("#modalBackground .modal");for(var o=0,e=modals.length;o<e;o++)if(new RegExp("(^| )open( |$)","gi").test(modals[o].className)){var n=m(modals[o].id);if(n.options.responsive&&null!=n.options.width){var i=screen.width-n.options.responsiveBrink,s=i<=modals[o].offsetWidth,a=i>modals[o].offsetWidth&&modals[o].offsetWidth<n.options.width;(s||a)&&(modals[o].style.width=i+"px")}break}},m=function(t){for(var o=null,e=0,n=l.length;e<n;e++)if(l[e].options.id===t){o=l[e];break}if(null==o)throw new Error("(Modal.js) The according modal instance no longer exists.");return o},f=function(){var t,o,n=null,i=function(e){t=e.target,(o=t.getAttribute("data-modal"))&&m(o).open(t)},a=function(o){if("modalBackground"===(t=o.target).id)for(var e=0,i=(n=document.querySelectorAll("#modalBackground .modal")).length;e<i;e++)if(new RegExp("(^| )open( |$)","gi").test(n[e].className)){var s=m(n[e].id);s.options.closeByOverlay&&s.close();break}},r=function(o){if("modal-close"===(t=o.target).className)for(var e=0,i=(n=document.querySelectorAll("#modalBackground .modal")).length;e<i;e++)if(new RegExp("(^| )open( |$)","gi").test(n[e].className)){m(n[e].id).close();break}},d=function(){for(var t=0,o=(n=document.querySelectorAll("#modalBackground .modal")).length;t<o;t++)if(new RegExp("(^| )open( |$)","gi").test(n[t].className)){var e=m(n[t].id);e.options.escapeClose&&e.close();break}};(s=document.body).addEventListener("click",function(t){i(t),r(t),e&&new RegExp("(^| )show( |$)","gi").test(e.className)&&a(t)}),document.addEventListener("keydown",function(t){e&&new RegExp("(^| )show( |$)","gi").test(e.className)&&27==t.keyCode&&d()}),window.addEventListener("resize",function(){e&&new RegExp("(^| )show( |$)","gi").test(e.className)&&u()});for(var c=null,f=0,v=l.length;f<v;f++)c=l[f],p(c.dom,c.options),h.call(c),c.options.autoOpen&&c.open()};document.onreadystatechange=function(){"complete"==document.readyState&&f()}}();